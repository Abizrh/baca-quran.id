<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/images/icon-32.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover" id="body">
		<div style="display: contents">%sveltekit.body%</div>

		<script>
			(function () {
				window.__header_theme = {
					dark: '#172642',
					light: '#f5f7fb',
					sepia: '#704214',
					yellow: '#ffff00'
				};
				window.__onThemeChange = function () {};
				var preferredTheme;
				try {
					preferredTheme = localStorage.getItem('theme');
				} catch (err) {}

				function setBodyClass(className) {
					document.getElementById('body').className = className;
				}

				function setTheme(newTheme) {
					window.__theme = newTheme;
					preferredTheme = newTheme;
					// document.body.className = newTheme;
					document.querySelector('html').className = newTheme;
					document
						.querySelector('meta[name="theme-color"]')
						?.setAttribute('content', window.__header_theme[newTheme]);

					window.__onThemeChange(newTheme);
				}

				window.__setPreferredTheme = function (newTheme) {
					setTheme(newTheme);
					try {
						if (newTheme === 'dark') {
							setBodyClass('theme-dark theme-dark:bg-blueish-600 theme-dark:text-gray-200');
						} else if (newTheme === 'sepia') {
							setBodyClass('theme-sepia theme-sepia:bg-[#704214] theme-sepia:text-gray-200');
						} else if (newTheme === 'yellow') {
							setBodyClass('theme-yellow theme-yellow:bg-yellow-500');
						}
						else if (newTheme === 'light') {
							setBodyClass('bg-white');
						}
						localStorage.setItem('theme', newTheme);
					} catch (err) {}
				};

				const colorSchema = {
					light: 'bg-white text-black',
					dark: 'theme-dark theme-dark:bg-blueish-600 theme-dark:text-gray-200',
					sepia: 'theme-sepia theme-sepia:bg-[#704214] theme-sepia:text-gray-200',
					yellow: 'theme-yellow theme-yellow:bg-yellow-500'
				};

				var darkQuery = window.matchMedia(`(prefers-color-scheme: ${preferredTheme})`);
				darkQuery.addListener(function (e) {
					window.__setPreferredTheme(colorSchema[preferredTheme]);
				});

				setTheme(colorSchema[preferredTheme]);
			})();
		</script>

		<!-- Install Service Worker -->
		<script>
			const registerServiceWorker = async () => {
				if ('serviceWorker' in navigator) {
					try {
						const registration = await navigator.serviceWorker.register('/sw.js', {
							scope: '/'
						});
						if (registration.installing) {
							console.debug('[Baca-Quran.id] > Service worker installing...');
						} else if (registration.waiting) {
							console.debug('[Baca-Quran.id] > Service worker installed!');
						} else if (registration.active) {
							console.debug('[Baca-Quran.id] > Service worker active!');
						}
					} catch (error) {
						console.error(`[Baca-Quran.id] > SW Registration failed with ${error}`);
					}
				}
			};
			registerServiceWorker();
		</script>
	</body>
</html>
